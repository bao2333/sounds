<template>
  <div>
    <el-breadcrumb separator="/">
      <el-breadcrumb-item :to="{ path: '/users/list' }" >用户管理</el-breadcrumb-item>
      <el-breadcrumb-item class="now_page">个人档案</el-breadcrumb-item>
    </el-breadcrumb>
    <header class="section_title">
      <img :src="$oss.url+personalData.head" alt="" width="50" height="50">
      <h3>{{ personalData.name }}</h3>
    </header>
    <section class="section_card">
      <article>
        <header >
          <h4>账号状态</h4>
        </header>
        <ul>
          <li><span>手机号</span><span>{{ personalDataBind.phoneNum }}</span></li>
          <li>
            <span>微博绑定</span>
            <span style="font-size:18px;color:blue;">
              {{ personalDataBindWB.binding==0?'未绑定':personalDataBindWB.binding==1?personalDataBindWB.weiBoName:'' }}
            </span>
          </li>
          <li>
            <span>微信绑定</span>
            <span style="font-size:18px;color:blue;">
              {{personalDataBindWX.binding==0?'未绑定':personalDataBindWX.binding==1?personalDataBindWX.wechatName:'' }}
            </span>
          </li>
          <li><span>举报别人</span><span>{{personalData.reportCount}}次</span></li>
          <li><span>当周被人举报</span><span>{{personalData.beReportCountInWeekday}}次</span></li>
        </ul>
      </article>
      <article>
        <header >
          <h4>个人信息</h4>
        </header>
        <ul>
          <li><span>生日</span><span>{{ new Date(personalData.birthday) | moment('YYYY-MM-DD') }}</span></li>
          <li><span>位置</span><span>{{ personalData.location==null?'未设置':personalData.location}}</span></li>
          <li>
            <span>标签</span>
            <el-button size="mini" class="select_label" @click="dialogVisible=true;selectDialog(0)">查看全部</el-button>
          </li>
          <li><span>粉丝</span><span>{{personalData.fansNum}}</span></li>
          <li><span>关注</span><span>{{personalData.followNum}}</span></li>
        </ul>
      </article>
      <article>
        <header >
          <h4>语音库</h4>
        </header>
        <ul class="sound_ku">
          <li>
            <span>个人介绍</span>
             <el-button size="mini" class="select_label" @click="dialogVisible=true;selectDialog(2)">语音和头像</el-button>
              <span>{{personalData.SelfIntroductionStatus==1?'待审核':''}}</span>
          </li>
          <li>
            <span>语音库</span>
            <el-button size="mini" class="select_label">查看全部</el-button>
            
          </li>
          <li>
            <span>购买语音库</span>
            <el-button size="mini" class="select_label">查看全部</el-button>
          </li>
        </ul>
      </article>
      <article>
        <header >
          <h4>账单明细</h4>
        </header>
        <ul>
          <li><span>账户余额</span><span> {{personalData.balance}} 金币</span></li>
          <!-- <li><span>收费率</span><span>20%</span></li> -->
          <li><span>总提现</span><span> +{{personalData.allIncomeWithdraw}} 金币</span></li>
          <li>
            <span>交易明细</span>
            <el-button size="mini" class="select_label">查看全部</el-button>
          </li>
          <li>
            <span>身份验证</span>
            <el-button size="mini" class="select_label" @click="dialogVisible=true;selectDialog(1)">查看证件</el-button>
            <span style="font-size:14px;">{{personalData.authenticationStatus==0?'未通过验证':personalData.authenticationStatus==1?'已通过验证':''}}</span>
          </li>
        </ul>
      </article>
      <article>
      <header >
        <h4>秀音卡</h4>
      </header>
      <header >
        <p>{{userNote.tone}} {{userNote.toneNum+'%'}}</p>
        <p>{{userNote.musicalityOne}} {{userNote.musicalityOneNum+'%'}}</p>
        <p>{{userNote.musicalityTwo}} {{userNote.musicalityTwoNum+'%'}}</p>
      </header>
      <ul class="soundCard">
        <li><p>星座</p><p>{{userNote.constellation}}</p></li>
        <li><p>属性</p><p>{{userNote.soundProperties}}</p></li>
        <li><p>最佳CP</p><p>{{userNote.bestCp}}</p></li>
      </ul>
      <footer>
        <span >播放秀音:</span>
        <audio-player class="sound_play" :url="userNote.voice" :form="type"/>
      </footer>
    </article>
      <article>
        <header >
          <h4>更多信息</h4>
        </header>
        <div class="moreInformation">
          <el-button type="text" @click="$router.push({name:'userHome',params:{userId:personalData.userId}})">查看个人主页</el-button>
          <el-button type="text">查看用户账单</el-button>
          <el-button type="text">查看查封账户</el-button>
          <p>首次注册时间：<span>{{ new Date(personalData.createTime) | moment('YYYY-MM-DD HH:mm:ss') }}</span></p>
          <p>最近使用觅语：<span>{{ new Date(personalData.latestLogin) | moment('YYYY-MM-DD HH:mm:ss') }}</span></p>
        </div>
      </article>
    </section>
    <!-- 弹窗 -->
    <el-dialog :title="type==0?'查看标签':type==1?'查看身份证':type==2?'查看语音和头像':''" :visible.sync="dialogVisible" width="30%">
        <!-- 查看标签 -->
        <ul v-if="type==0" class="dialog_label">
          <li v-for="(item,index) in personalData.labels" :key="index">
            {{ item.name }}
          </li>
        </ul>
        <!-- 查看身份证 -->
        <div v-if="type==1" class="dialog_idCard">
          <img :src="$oss.url + personalDataAuthentication.frontCard" alt="">
          <img :src="$oss.url + personalDataAuthentication.backCard" alt="" >
        </div>
        <!-- 语音和头像 -->
        <div v-if="type==2"  class="dialog_personal">
            <img :src="$oss.url +dataSelf.picture" alt="">
            <audio-player :url="dataSelf.voice" :second="dataSelf.second" style="float:left;margin:30px 0 0 30px;"/>
        </div>
    </el-dialog>
  </div>
</template>

<script>
  import audioPlayer from '../../components/audioPlayer'
    export default {
        name: "personalFile",
      components:{
        'audio-player':audioPlayer
      },
      data(){
          return{
            dialogVisible:false,
            personalData:{},
            personalDataBind:{},
            personalDataBindWB:{},
            personalDataBindWX:{},
            userNote:{},
            personalDataAuthentication:{},
            dataSelf:{},
            type:'',
            personal_js:'',   //个人介绍下拉
            type:1
          }
      },
      created(){
       
      },
      mounted(){
         this.getList();
      },
      methods:{
        getList(){
          this.$api.user.personal_file(data=>{
            this.personalData = data
            this.personalDataAuthentication = data.authentication
            this.personalDataBind = data.bind.phone
            this.personalDataBindWB = data.bind.weiBoAuth
            this.personalDataBindWX = data.bind.wechatAuth
            this.userNote = data.userTakeNote
            this.dataSelf = data.SelfIntroduction

          },{
            userId:parseInt(this.$route.params.userId)
          })
        },
        selectDialog(type){
          this.type = type;
        }
      }
    }
</script>

<style scoped lang="less">
  @theme_color:rgb(255, 64, 129);
  .section_title{
    width: 300px;
    margin: 0 auto;
    overflow: hidden;
    border-bottom: 1px solid #ccc;
    position: relative;
    img{
      border-radius: 50%;
      vertical-align: top;
      position: absolute;
      left: 20px;
    }
    h3{
      /*display: inline-block;*/
      line-height: 50px;
      margin-left: 15px;
      text-align: center;
      float: right;
    }
  }
  .section_card{
    margin-top: 15px;
    article:nth-of-type(odd){
      margin-right: 50px;
    }
    article{
      width: 46%;
      height: 300px;
      border:1px solid #ccc;
      float: left;
      margin-top: 15px;
      header{
        width: 400px;
        margin: 15px auto;
        border-bottom: 1px solid #ccc;
        overflow: hidden;
        h4{
          text-align: center;
        }
        p{
          text-align: center;
          margin-bottom: 0;
          font-size: 16px;
          color:@theme_color ;
        }
        p:nth-of-type(2){
          float: left;
          margin-top: 15px;
          color: #16dcf2;
        }
        p:nth-of-type(3){
          float: right;
          margin-top: 15px;
          margin-bottom: 10px;
          color: #4f9e4f;
        }
      }
      ul{
        /*padding: 15px 30px;*/
        li{
          display: block;
          overflow: hidden;
          span{
            font-size: 20px;
            line-height: 35px;
            width: 150px;
            text-align: center;
          }
          span:nth-of-type(1){
            display: block;
            float: left;
            margin-left: 100px;
          }
          span:nth-of-type(2){
            display: block;
            float: right;
            margin-right: 100px;
            width: 160px;
          }
          .select_label{
            background-color:@theme_color ;
            color: #fff;
            float: right;
            margin-right: 140px;
          }
          .personal_zujianPlayer{
            float: right;
            margin-right: 20px;
          }
        }
      }
      ul.sound_ku{
        li{
          height: 70px;
          .personal_js{
            width: 90px;
            float: right;
            margin-right: 20px;
          }
        }
      }
      ul.soundCard{
        width: 80%;
        margin: 15px auto;
        border-bottom: 1px solid #ccc;
        overflow: hidden;
        li{
          width: 33%;
          float: left;
          text-align: center;
          p{
            font-size: 16px;
          }
          p:nth-of-type(2){
            color:@theme_color ;
          }
        }
      }
      footer{
        width: 240px;
        margin: 10px auto;
        span{
          float: left;
          margin-top: 7px;
          margin-right: 30px;
          font-size: 16px;
        }
        .sound_play{
          display: inline-block;
        }
      }
      .moreInformation{
        .el-button{
          margin: 0 auto;
          display: block;
          font-size: 16px;
        }
        p{
          text-align: center;
          font-size: 16px;
          span{
            color: @theme_color;
          }
        }
      }
    }
  }
  .dialog_label{
    overflow: hidden;
    li{
      float: left;
      padding:5px 15px;
      border:1px solid #ccc;
      margin-right: 10px;
      margin-top: 15px;
    }
  }
  .dialog_idCard{
    overflow: hidden;
    img{
      display: inline-block;
      width: 200px;
      height: 100px;
      border:1px solid #ccc;
      margin-right: 15px
    }
  }
  .dialog_personal{
    overflow: hidden;
    img{
      width: 100px;
      height: 100px;
      border:1px solid #ccc;
      float: left;
    }
  }
</style>
