<template>
  <div class="box">
      <!-- 头像 -->
    <div class="add_head" @click="selectIcon">
      <img :src="$oss.url+editorImg" alt width="150" height="150">
      <i class="el-icon-plus avatar-uploader-icon" v-show="plusShow"></i>
    </div>
    <input
      accept="image/jpeg, image/png"
      ref="iconFile"
      @change="iconFileChange"
      type="file"
      name="icon"
      style="display: none"
    >
    <!-- 标题 -->
    <h3>{{ this.$route.params.title }}</h3>
    <!-- 富文本，动态内容 -->
    <div class="edit" style="margin-top: 15px;float:left">
        <quill-editor ref="textEditor" v-model="articleContent" :options="editorOption" style="width:100%;margin:15px 0 20px 30px;height:auto;">
        </quill-editor>
    </div>
    <!-- 上传 -->
    <main>
        <ul>
            <li v-if="type==0">
                <img :src="$oss.url + item" alt="" v-for="(item,index) in imgs" :key="index" width="150">
            </li>
            <li v-if="type==1">
               <video src=""></video> 
            </li>
            <li v-if="type==2">
               <audio src=""></audio>
            </li>
        </ul>
    </main>
  </div>
</template>

<script>
import * as OSS from "ali-oss";
export default {
  name: "editor",
  data() {
    return {
      plusShow: true,
      editorImg: "",
      editorOption: {
        modules: {
        toolbar: [
            ['bold', 'italic', 'underline', 'strike'],
            ['blockquote'],
            [{ 'list': 'ordered' }, { 'list': 'bullet' }],
            [{ 'script': 'sub' }, { 'script': 'super' }],
            [{ 'indent': '-1' }, { 'indent': '+1' }],
            [{ 'size': ['small', false, 'large', 'huge'] }],
            [{ 'color': [] }, { 'background': [] }],
            ['clean'],
            [{ 'align': [] },'image'],
            ]
        },
        placeholder:'请输入文章内容 ...'
        },
        articleContent:'',
        type:'',
        imgs:[],
    };
  },
  created() {},
  mounted() {
    this.getInfomation()
  },
  methods: {
    getInfomation() {
        this.editorImg = this.$route.params.url;
        this.articleContent = this.$route.params.article;
        this.type = this.$route.params.type;
        this.imgs = this.$route.params.imgs;
    },
    //上传图片
    selectIcon() {
      this.$refs.iconFile.click();
      this.$refs.iconFile.value = null; //相同图片上传第二次的时候会导致失效，每次上传之前清空value
    },
    iconFileChange(e) {
      let file = e.target.files[0];
      if (!file.name.substring(file.name.lastIndexOf(".")) == ".png") {
        return;
      }
      let reader = new FileReader();
      reader.onload = e => {
        let data = e.target.result;
        //加载图片获取图片真实宽度和高度
        let image = new Image();
        image.onload = () => {
          let width = image.width;
          let height = image.height;
          // if( width <400 || height<200){
          //   this.$notify.error({
          //     title: '操作提示',
          //     message: '图片大小必须大于400*200！'
          //   });
          //   return;
          // }
          this.$api.oss.update(data => {
            new OSS.Wrapper({
              region: "oss-cn-hangzhou",
              accessKeyId: data.accessKeyId,
              accessKeySecret: data.accessKeySecret,
              stsToken: data.securityToken,
              bucket: "zhiyuan-hz"
            })
              .put(data.random, file)
              .then(data => {
                console.log(data);
                // this.form.img = `http://oss.dev.51zhiyuan.net/`+data.name;
                this.editorImg = data.name;
                this.plusShow = false;
              })
              .catch(function(err) {
                console.error("error: %j", err);
              });
          }, {});
        };
        image.src = data;
      };
      reader.readAsDataURL(file);
    }
  }
};
</script>

<style scoped lang="less">
.box {
  width: 800px;
  margin: 0 auto;
  border: 1px solid #ccc;
  overflow: hidden;
  h3 {
    margin-top: 20px;
    margin-left: 10px;
    float: left;
  }
  .add_head {
    width: 150px;
    height: 150px;
    border: 1px dashed #ccc;
    float: left;
    position: relative;
    margin-top: 20px;
    margin-left: 30px;
    cursor: pointer;
    i {
      position: absolute;
      left: 50%;
      top: 50%;
      margin-left: -12.5px;
      margin-top: -12.5px;
      font-size: 25px;
    }
  }
  main{
      float: left;
      ul{
          margin-left: 30px;
          li{
            img{
                margin-right: 10px;
            }
          }
      }
  }
}
</style>
