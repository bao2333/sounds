webpackJsonp([9],{W1ic:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/Z0X"),a={name:"official",data:function(){return{showIcon:!0,upadteImg:"",officalData:[],editorOption:{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["clean"],[{align:[]},"image"]]},placeholder:"请输入消息内容 ..."},articleContent:"",size:null,count:null,total:null,page:1,title:"",ossurl:"",itemContent:null}},created:function(){this.getList(),document.onkeydown=function(t){if(13==window.event.keyCode)return!1}},methods:{handleCurrentChange:function(t){this.page=t,this.getList()},getList:function(){var t=this,e=this.page;this.$api.find.offical_list(function(e){t.officalData=e.data,e.data.map(function(e){t.$ajax.get("http://sounds-miyu.oss-cn-hangzhou.aliyuncs.com/"+e.content).then(function(t){e.content=t.data})}),t.size=e.pageNum.pageSize,t.count=e.pageNum.pages,t.total=e.pageNum.total},{pageNum:e})},addOffical:function(){var t=this;this.$api.oss.update(function(e){new i.Wrapper({region:"oss-cn-hangzhou",accessKeyId:e.accessKeyId,accessKeySecret:e.accessKeySecret,stsToken:e.securityToken,bucket:"sounds-miyu"}).put(e.random,new Blob([t.articleContent])).then(function(e){""==t.ossurl||""==t.title||""==t.articleContent?t.$notify({type:"warning",message:"请完善信息后再进行添加!",title:"警告"}):t.$api.find.offical_add(function(){t.getList(),t.$notify({type:"success",message:"添加消息成功!",title:"成功"}),t.ossurl="",t.title="",t.articleContent="",t.showIcon=!0},{icon:t.ossurl,title:t.title,content:e.name})}).catch(function(t){console.error("error: %j",t)})},{})},deleteNews:function(t){var e=this;this.$confirm("确定要删除此条官方消息吗?","提示",{confirmButtonText:"狠心删除",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.find.offical_delete(function(){e.getList(),e.$notify({type:"success",message:"删除消息成功!",title:"成功"})},{id:t})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},selectIcon:function(){this.$refs.iconFile.click(),this.$refs.iconFile.value=null},iconFileChange:function(t){var e=this,n=t.target.files[0];if(".png"!=!n.name.substring(n.name.lastIndexOf("."))){var a=new FileReader;a.onload=function(t){var a=t.target.result,s=new Image;s.onload=function(){s.width,s.height;e.$api.oss.update(function(t){new i.Wrapper({region:"oss-cn-hangzhou",accessKeyId:t.accessKeyId,accessKeySecret:t.accessKeySecret,stsToken:t.securityToken,bucket:"sounds-miyu"}).put(t.random,n).then(function(t){e.ossurl=t.name,e.showIcon=!1}).catch(function(t){console.error("error: %j",t)})},{})},s.src=a},a.readAsDataURL(n)}}}},s=n("XyMi");var o=function(t){n("vzsE"),n("hHE0")},c=Object(s.a)(a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",{attrs:{to:{path:""}}},[t._v("消息管理")]),t._v(" "),n("el-breadcrumb-item",{staticClass:"now_page"},[t._v("官方消息")])],1)],1),t._v(" "),n("section",[n("h3",[t._v("编辑官方消息")]),t._v(" "),n("div",{staticClass:"update_img"},[n("div",{staticClass:"add_head",on:{click:t.selectIcon}},[n("img",{attrs:{src:t.$oss.url+t.ossurl,alt:"",width:"148",height:"148"}}),t._v(" "),n("i",{directives:[{name:"show",rawName:"v-show",value:t.showIcon,expression:"showIcon"}],staticClass:"el-icon-plus avatar-uploader-icon"})]),t._v(" "),n("input",{ref:"iconFile",staticStyle:{display:"none"},attrs:{accept:"image/jpeg,image/png",type:"file",name:"icon"},on:{change:t.iconFileChange}})]),t._v(" "),n("el-input",{staticStyle:{width:"20%",margin:"15px auto",display:"block"},attrs:{size:"mini",placeholder:"请输入消息标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),n("div",{staticClass:"edit",staticStyle:{"margin-top":"15px"}},[n("quill-editor",{ref:"textEditor",staticStyle:{width:"70%",margin:"15px auto",height:"auto"},attrs:{options:t.editorOption},model:{value:t.articleContent,callback:function(e){t.articleContent=e},expression:"articleContent"}})],1),t._v(" "),n("el-button",{staticClass:"submitBtn",attrs:{size:"small"},on:{click:function(e){t.addOffical()}}},[t._v("保存")])],1),t._v(" "),n("hr"),t._v(" "),n("main",[n("h3",[t._v("消息列表")]),t._v(" "),t._l(t.officalData,function(e,i){return n("article",{key:i},[n("div",{staticClass:"article_header"},[n("p",[n("img",{staticStyle:{"margin-right":"10px"},attrs:{src:t.$oss.url+e.icon,alt:"",width:"40",height:"40"}}),t._v(" "+t._s(e.title))]),t._v(" "),n("i",{staticClass:"el-icon-delete avatar-uploader-icon deleteIcon",on:{click:function(n){t.deleteNews(e.id)}}})]),t._v(" "),n("div",{staticClass:"article_p",domProps:{innerHTML:t._s(e.content)}}),t._v(" "),n("div",[n("p",{staticClass:"footer_p"},[n("i",[t._v(t._s(t._f("moment")(new Date(e.createTime),"YYYY-MM-DD HH:mm:ss")))])])])])}),t._v(" "),n("div",{staticClass:"block",staticStyle:{float:"right","margin-top":"15px"}},[n("el-pagination",{attrs:{layout:"total,prev, pager, next","page-size":t.size,background:"","page-count":t.count,total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],2)])},[],!1,o,"data-v-140987cc",null);e.default=c.exports},hHE0:function(t,e){},vzsE:function(t,e){}});